{% extends "auth.html" %}

{% block regular_content %}
{% if tutorial %}
<div id = "tutorial-pop-up" class = "z-50 fixed hidden" style = "width: 500px; top: 20%; left: 50%; transform: translate(-50%, -50%);" >
      <div class = "bg-blue-500 border border-black rounded-lg px-8 py-4 text-center" >
          <h2 id = "tutorial_title" class = "text-white" > </h2 >
          <p id = "tutorial_text" > </p >
          <button id = "tutorial_next_button" class = "green-btn mt-4" > {{_('next_step_tutorial')}} < /button >
      </div >
  </div>
{% endif %}
<div class="flex-col">
  <div class="flex flex-row gap-4 mb-8 mt-10 md:px-16">
    <div class="flex flex-col items-left gap-3 bg-gray-200 border border-gray-400 px-10 rounded-lg w-full lg:w-2/4 p-8">
      <h2 class="m-0 basis-1/12"> {{_('classes')}} </h2>
      <div class="text-black basis-10/12">
      <p>{{ _('classes_info') }}</p>
      </div>
      <div class="flex flex-row gap-3 justify-end basis-1/12">
        <button class="green-btn inline-flex items-center" id="create_class_button" onclick='hedyApp.create_class ({{_('class_name_prompt')|default(None)|tojson}})'
        {% if second_teacher and role == 'viewer' %}disabled{% endif %}>{{_('create_class')}}</button>
        <button class="white-btn inline-flex items-center gap-2" id="view_classes"
        _="on click toggle .hidden on #classes_table
        set arrow to #classes_arrow
        if not arrow.classList.contains('rotate-180')
          add .rotate-180 to arrow
        else
          remove .rotate-180 from arrow"
        >
        <span>{{_('view_classes')}}</span>
        <svg id="classes_arrow" class="fill-current h-6 w-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
          <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z" />
        </svg>
      </button>
      </div>
    </div>
    <div class="flex flex-col items-left gap-3 bg-gray-200 border border-gray-400 px-10 rounded-lg w-full lg:w-2/4 p-8">
      <h2 class="m-0 basis-1/12"> {{_('adventures')}} </h2>
      <div class="text-black basis-10/12">{{ _('adventures_info') }}</div>
      <div class="flex gap-3 justify-end basis-1/12">
            <button id="create_adventure_button" class="green-btn inline-flex" 
              hx-trigger="click"
              hx-post="/for-teachers/create-adventure"
              hx-swap="none"
              _="on htmx:afterRequest if detail.xhr.response
              window.open('/for-teachers/customize-adventure/' + detail.xhr.response, '_self')"
              data-cy="edit-link"{% if second_teacher and role == 'viewer' %}disabled{% endif %}>{{_('create_adventure')}}</button>
            <button class="white-btn inline-flex" id="view_adventures"
            _="on click toggle .hidden on #adventures_table
            set arrow to #adventures_arrow
            if not arrow.classList.contains('rotate-180')
              add .rotate-180 to arrow
            else
              remove .rotate-180 from arrow">
            <span>{{_('view_adventures')}}</span>
            <svg id="adventures_arrow" class="fill-current h-6 w-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
              <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z" />
            </svg>
          </button>
      </div>
    </div>
  </div>
  <div class="flex flex-col gap-4 mb-8 md:px-16 hidden" id="classes_table">
    <div class="flex flex-col gap-4 pb-4 bg-gray-200 border border-gray-400 px-10 rounded-lg w-full lg:w-4/4 p-8">
      <h2 class="m-0 justify-left"> {{_('my_classes')}} </h2>
      <div class="overflow-hidden rounded-lg shadow-lg">
        <table class="w-full border border-gray-400">
        <thead>
          <tr class="bg-blue-300 text-blue-900">
            <th class="px-10 py-2 text-center">{{_('name')}}</th>
            <th class="px-10 py-2 text-center">{{_('teacher')}}</th>
            <th class="px-10 py-2">{{_('students')[0]|upper}}{{_('students')[1:]}}</th>
            <th class="px-4 p-2 bg-blue-900 text-white">{{_('actions')}}</th>
          </tr>
        </thead>
        <tbody>
          {% for class in teacher_classes %}
            <tr class="{% if loop.index is divisibleby 2 %}bg-gray-200{% else %}bg-white{% endif %}">
              <td class="text-center px-4 py-2"><a href="for-teachers/class/{{class.id}}" class="view_class" data-cy="view_class_link">{{class.name|e}}</a></td>
              <td id="teacher_cell" class="text-center p-2">{{class.teacher}}</td>
              <td class="text-center p-2">{{class.students|length}}</td>
              <td class="text-center p-2">
                <div class="flex justify-center text-blue-900">
                  <button class="flex flex-col items-center mr-16"
                  _="on click window.open('/for-teachers/customize-class/{{class.id}}', '_self')">
                    <span class="fas fa-pen block mb-1"></span>
                    <span>{{_('customize')}}</span>
                  </button>
                  <button class="flex flex-col items-center mr-16" id="duplicate_class"
                  onclick='hedyApp.duplicate_class("{{class.id}}", "{{class.second_teachers}}", {{_('second_teacher_copy_prompt')|default(None)|tojson}}, {{_('class_name_prompt')|default(None)|tojson}}, {% if class.teacher != username %}"{{class.name}}"{% else %}" "{% endif %})'>
                    <span class="fas fa-copy block mb-1"></span>
                    <span>{{_('duplicate')}}</span>
                  </button>
                  <button class="flex flex-col items-center mr-16"
                  _="on click window.open('/for-teachers/class/{{class.id}}/preview', '_self')">
                    <span class="fas fa-eye block mb-1"></span>
                    <span>{{_('preview')}}</span>
                  </button>
                  <button class="flex flex-col items-center"
                  onclick='hedyApp.delete_class("{{class.id}}", {{_('delete_class_prompt')|default(None)|tojson}})'>
                    <span class="fas fa-trash block mb-1 text-red-700"></span>
                    <span class="text-red-700">{{_('remove')}}</span>
                  </button>
                </div>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
      </div>
      </div>
    </div>
    <div class="flex flex-col gap-4 mb-8 md:px-16 hidden" id="adventures_table">
      <div class="flex flex-col gap-4 pb-4 bg-gray-200 border border-gray-400 px-10 rounded-lg w-full lg:w-4/4 p-8">
        <h2 class="m-0 justify-left"> {{_('my_adventures')}} </h2>
        <div class="overflow-hidden rounded-lg shadow-lg">
        <table class="w-full border border-gray-400">
          <thead>
            <tr class="bg-blue-300 text-blue-900">
              <th class="px-10 py-2 text-center">{{_('name')}}</th>
              <th class="px-10 py-2 text-center">{{_('creator')}}</th>
              <th class="px-10 py-2 text-center">{{_('owner')}}</th>
              <th class="p-2">{{_('level')}}</th>
              <th class="p-2 hidden sm:block">{{_('last_update')}}</th>
              <th class="px-4 p-2 bg-blue-900 text-white">{{_('actions')}}</th>
            </tr>
          </thead>
          <tbody>
            {% for adventure in teacher_adventures %}
              <tr class="{% if loop.index is divisibleby 2 %}bg-gray-200{% else %}bg-white{% endif %}">
                <td class="text-center px-4 py-2"><a href="for-teachers/customize-adventure/{{adventure.id}}" class="no-underline" data-cy="edit-link">{{adventure.name|e}}</a></td>
                <td class="text-center owner_username_cell">{{adventure.author or adventure.creator}}</td>
                <td class="text-center username_cell">{{adventure.creator}}</td>
                <td class="text-center p-2">
                  {% if adventure.levels %}
                      {% for level in adventure.levels %}
                          {{level}}{% if loop.index != adventure.levels|length %}, {% endif %}
                      {% endfor %}
                    {% elif adventure.level %}
                      {{adventure.level}}
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td class="text-center p-2 hidden sm:block">{{adventure.date}}</td>
                <td class="text-center p-2">
                  <div class="flex justify-center text-blue-900">
                    <button class="flex flex-col items-center mr-16"
                    _="on click window.open('/adventure/{{ adventure.name }}?creator={{ adventure.creator }}', '_self')">
                      <span class="fas fa-eye block mb-1"></span>
                      <span>{{_('preview')}}</span>
                    </button>
                    <button class="flex flex-col items-center" data-cy="delete-adventure"
                    onclick='hedyApp.delete_adventure("{{adventure.id}}", {{_('delete_adventure_prompt')|default(None)|tojson}})'>
                      <span class="fas fa-trash block mb-1 text-red-700"></span>
                      <span class="text-red-700">{{_('remove')}}</span>
                    </button>
                  </div>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
        </div>
        </div>
      </div>
      <div class="flex flex-row gap-4 mb-8 md:px-16" id="row">
        <div class="flex flex-col items-left gap-3 bg-gray-200 border border-gray-400 px-10 rounded-lg lg:w-2/4 p-8" id="slides">
        <h2 class="m-0 basis-1/12"> {{_('slides')}} </h2>
        <div class="text-black basis-10/12">{{ _('slides_info') }}</div>
        <div class="flex flex-row gap-3 justify-end basis-1/12">
          <!-- it's ugly to add a fixed height to content_table, to solve it from growing with slides, but not sure how else to fix it-->
          <button class="white-btn inline-flex items-center"
          _="on click toggle .hidden on #slides_table
          set arrow to #slides_arrow
          if not arrow.classList.contains('rotate-180')
            add .rotate-180 to arrow
            add .max-h-80 to #content_table
          else
            remove .rotate-180 from arrow
            remove .max-h-80 from #content_table"
          >
          <span>{{_('view_slides')}}</span>
            <svg id="slides_arrow" class="fill-current h-6 w-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
              <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z" />
            </svg>
          </button>
        </div>
        <div class="w-full hidden" id="slides_table">
            {% for level in slides %}
            <div class="bg-gray-100 border rounded-lg mb-4 p-2 flex justify-between items-center">
                <div class="text-left text-blue-500 font-semibold ml-6">
                    {% if level == 0 %}
                    {{_('hedy_introduction_slides')}}
                    {% else %}
                    {{_('slides_for_level')}} {{level}}
                    {% endif %}
                </div>
                <div class="flex flex-row gap-3 mb-2 mr-6">
                    <iframe class="hidden" id="level-{{level}}-slides" data-src="/slides/{{level}}" src="about:blank"></iframe>
                    <a class="green-btn mt-4" href="/slides/{{level}}" target="_blank">
                        {{_('view_slides')}}
                    </a>
                    <button class="white-btn mt-4" id="download-slides-{{level}}" onclick="hedyApp.downloadSlides({{level}})">
                        {{_('download')}}
                        <a class="fa fa-download"></a>
                    </button>
                </div>
            </div>
            {% endfor %}
        </div>
        </div>
        <div class="flex flex-col items-left gap-3 bg-gray-200 border border-gray-400 px-10 rounded-lg lg:w-2/4 p-8" id="content_table">
          <h2 class="m-0 basis-1/12"> {{_('public_content')}} </h2>
          <div class="text-black basis-10/12">{{ _('public_content_info') }}</div>
          <div class="flex flex-row gap-3 justify-end basis-1/12">
            <button id="public-adventures-link" class="blue-btn inline-flex items-center"
            _="on click window.open('/public-adventures', '_self')">{{_('public_adventures')}}</button>
        </div>
  </div>
</div>
{% endblock %}
